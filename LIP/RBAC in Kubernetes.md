There are a lot of parts about Kubernetes that are hard. Once everything is configured, compute resources are easier to scale in interesting ways, but getting there can be complicated. One of the more challenging aspects of Kubernetes is the idea of Roles and Role Based Access Control, or RBAC. When you first set up a kubernetes cluster, you will probably see a kubeconfig file that gives you the full Cluster Admin role. And while it is easy to share that kubeconfig with others, you really shouldn't. 

If everyone is a cluster admin, then anyone can do things they shouldn't. What can a cluster admin do? Well, everything from delete existing services and pods, or running processes that might be against company policy, all the way up to deleting nodes. Some of these actions could be intentional while others, perhaps most, are probably accidental. Once you are a cluster admin, its too easy to copy and paste a command that destroys your environment. And if your machine is compromised, the attacker can also do anything they like. 

The principle of least privilege says that a subject should be given only those privileges needed for it to complete its task. This applies to kubernetes just as much as it does to the operating system on your computer. But how do you give a user access to just the things they need in the cluster. Or how about giving an application just the rights it needs? Well, it turns out it is pretty simple

All you need is to define the user and the role and then bind the role to the user. The only problem is that there aren't really users in kubernetes... a user name is actually the common name of a certificate. So defining a user is as simple as generating a new certificate. But to generate that cert, you need to use the certificate and key of the certificate authority in the kubernetes cluster. So you will probably need a tool like openssl, because you aren't actually going to be able to do that with kubectl. And its not actually one command you need to run, because you actually need to start with a private key and then a certificate signing request, and then use that in conjunction with the CA to actually generate the certificate for the user. 

Then you need to build the kube config file so that starts by defining a cluster which includes  the public key of the certificate authority as well as the address of the api server. Then you need to add the credentials for the user which is really the certificate you generated. Then you need to add the context which links the cluster to the user. OK, so thatâ€™s not too hard, right? Oh, and you really should update the cert and thus the kubeconfig fairly often... 5 minutes is a good interval. Oh, and you are going to need to do this for all your users...every 5 minutes

And despite all those steps we have done, we have only created a user. Remember, we need to define the user and a role, and then bind the role to the user. If that user tries to do anything right now they will get an error since they aren't allowed to do anything yet. 

Now you need to create the roles and bind the roles to the user certificate. Defining roles is a bit easier. Your roles are going to be a collection of verbs and the resources those verbs apply to. The verbs you can include can be found in the chart on this page (https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb). The resources can include any of the resources available in your cluster. 

So creating roles is relatively easy but users is a bit of a challenge. If however, you are using Infra, the user part and linking the user to the role is just as easy. 

Lets take a look at the roles that are defined on this cluster. There are actually two types of roles in Kubernetes: Roles and ClusterRoles. Roles are defined per namespace and clusterroles are defined for the cluster. You can see that there are a lot of cluster roles defined for the system to function. You probably won't ever touch those. The roles that you probably will use include view, edit, admin, and cluster-admin. We will look at these in more detail as well as create new roles in a future video. 

Let's close out this video by using one of these roles for a new user. The command to create a new user is ... . That command includes the role. And a user can have many roles. One very important thing to remember is that roles and permissions in kubernetes are additive. If any role that a user has defines access to a resource, then the user has access no matter what the other roles define. 


that was a bit too user focused. lets just look at rbac and roles in the first one.

RBAC. Role Based Access Control. You will see that term used in lots of different tools. Essentially it comes down to a simple concept. Chances are each user doesn't have a unique level of access to most of an application. So we create roles that users can share. All the users who are editors have the editor role. And all the admins have the level of access an admin should have. So you define the role and what access that role should have, and then bind those roles to users. 

In kubernetes, you can have many roles bound to any one user, but its important to remember that access in kubernetes is additive. If a user has been assigned a role that is minimal in the level of access it provides but they have also been assigned a role with more access they have all the access defined in all the roles. There is no way to remove access without removing the role that provided access. In a simple test environment, this is easy to deal with, but in a larger environment where a user may have hundreds of roles, navigating through permissions can be a challenge. There are tools to help navigate those permissions and in a future video we will take a look at some of them.

Creating roles in Kubernetes is somewhat easy. You define which resource you want the subject to have access to. We switched over to the word 'subject' because that can refer to both a human user as well as a process running an application automatically. Then you list out the verbs that subject should be able to apply to that resource. There are a number of verbs that work. Get will get all the 